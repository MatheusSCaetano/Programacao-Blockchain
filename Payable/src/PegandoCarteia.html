<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../node_modules/web3/dist/web3.min.js"></script>
    <title>Document</title>
</head>
<body>
    <button id="conectar">Conectar</button>
    <button id="recuperar">Recuperar Nome</button>
    <button id="alterar">Alterar Nome</button>


    <script>
        async function conectar(){

            let resultado = await ethereum.request({method:'eth_requestAccounts'});
            console.log(resultado);

        }
        async function run(){
            const web3 = await new Web3(window.ethereum);
            let contas = await web3.eth.getAccounts();
            console.log(web3);
            console.log("Contas: ", contas);

        }
        var abi = [ { "inputs": [], "stateMutability": "nonpayable", "type": "constructor" }, { "inputs": [], "name": "nome", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "stateMutability": "view", "type": "function", "constant": true }, { "inputs": [ { "internalType": "string", "name": "_novoNome", "type": "string" } ], "name": "mudaNome", "outputs": [], "stateMutability": "nonpayable", "type": "function" } ];
        var endereco = '0xa49E119d4756015FaF55BC46e56b4bC508BDeDbC';

        async function recuperar(){
            const web3 = await new Web3(window.ethereum);
            let contrato = await new web3.eth.Contract(abi, endereco);
            let nome = await contrato.methods.nome().call();
            console.log(nome);
        }
        async function pegarConta(){
            let contas = await web3.eth.getAccounts();
            conta = contas[0];
            console.log(conta)
            
        }

        async function alterar(){
            const web3 = await new Web3(window.ethereum);

            let contas = await web3.eth.getAccounts();
            conta = contas[0];
            console.log(conta)

            let contrato = await new web3.eth.Contract(abi,endereco);
            let receipt = await contrato.methods.mudaNome("Matheus").send({from:conta });
            console.log(receipt);

        }

        document.getElementById("conectar").addEventListener('click',conectar);
        document.getElementById("recuperar").addEventListener('click',recuperar);
        document.getElementById("alterar").addEventListener('click',alterar);


        
        run();


    </script>
    

</body>
</html>